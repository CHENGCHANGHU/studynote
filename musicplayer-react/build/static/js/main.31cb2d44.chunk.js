(this["webpackJsonpmusicplayer-react"]=this["webpackJsonpmusicplayer-react"]||[]).push([[0],{133:function(e,t,r){e.exports=r(342)},340:function(e,t,r){},341:function(e,t,r){},342:function(e,t,r){"use strict";r.r(t);var n=r(2),a=r.n(n),c=r(132),o=r.n(c);r(138),r(340),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(341);function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,a,c,o){try{var i=e[c](o),s=i.value}catch(u){return void r(u)}i.done?t(s):Promise.resolve(s).then(n,a)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function o(e){l(c,n,a,o,i,"next",e)}function i(e){l(c,n,a,o,i,"throw",e)}o(void 0)}))}}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(i,e);var t,r,n,c,o=(t=i,function(){var e,r=b(t);if(M()){var n=b(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return y(this,e)});function i(){var e;p(this,i),w(v(e=o.apply(this,arguments)),"openMusicPanel",(function(){e.setState(m({},e.state,{panelFlag:!e.state.panelFlag}))})),w(v(e),"playMusic",(function(){console.log("MusicPlayer: \u64ad\u653e\u6b4c\u66f2"),e.setState(m({},e.state,{playFlag:!0})),console.log(e.state.theMusicAudio.currentTime,e.state.currMusicDuration),e.state.theMusicAudio.play()})),w(v(e),"pauseMusic",(function(){console.log("MusicPlayer: \u6682\u505c\u6b4c\u66f2"),e.setState(m({},e.state,{playFlag:!1})),e.state.theMusicAudio.pause()})),w(v(e),"changeMusicByMusicPanel",function(){var t=f(regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(n,r.id,r.title),e.state.theMusicAudio.src=e.state.baseUrl+r.musicSrc,t.next=4,e.playMusic();case 4:e.setState(m({},e.state,{currMusicObj:r,currMusicIndex:n}));case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),w(v(e),"clickLocalMusicHandler",(function(t){console.log("\u672c\u5730\u97f3\u4e50\u70b9\u51fb\u4e8b\u4ef6",e.refs.localFile),e.refs.localFile.click()})),w(v(e),"changeMusicByInputFile",(function(t){var r=e.state.musicList;console.log("\u97f3\u4e50\u8f93\u5165\u6539\u53d8");var n=t.target.files[0];if(console.log(n),n){var a=new FileReader;a.readAsDataURL(n),a.onprogress=function(e){console.log(e)},a.onload=function(){console.log("\u672c\u5730\u97f3\u4e50\u52a0\u8f7d\u5b8c\u6210");var t=window.URL.createObjectURL(n);console.log(t),e.state.theMusicAudio.src=t,e.setState(m({},e.state,{musicList:[].concat(s(r),[{id:r.length+1,title:n.name,picSrc:"/sample/img/music-4.png",musicSrc:t}])}))}}})),w(v(e),"changeMusicByPrev",f(regeneratorRuntime.mark((function t(){var r,n,a,c,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.state,n=r.theMusicAudio,a=r.currMusicIndex,c=r.musicList,o=a>0?a-1:c.length-1,n.src=c[o].musicSrc,t.next=5,e.setState(m({},e.state,{currMusicObj:c[o],currMusicIndex:o}));case 5:e.playMusic();case 6:case"end":return t.stop()}}),t)})))),w(v(e),"changeMusicByNext",f(regeneratorRuntime.mark((function t(){var r,n,a,c,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.state,n=r.theMusicAudio,a=r.currMusicIndex,c=r.musicList,o=a<c.length-1?a+1:0,n.src=c[o].musicSrc,t.next=5,e.setState(m({},e.state,{currMusicObj:c[o],currMusicIndex:o}));case 5:e.playMusic();case 6:case"end":return t.stop()}}),t)})))),w(v(e),"clickProgressBarHandler",(function(t){var r=e.state,n=(r.theMusicAudio,r.currMusicDuration,t.clientX),a=t.target,c=a.offsetLeft,o=a.offsetWidth,i=Math.min(1,Math.max(0,(n-c)/o));console.log("\u8fdb\u5ea6\u6761\u70b9\u51fb\u4e8b\u4ef6",n,c,o,i)})),w(v(e),"clickBufferedBarHandler",(function(t){var r=e.state,n=r.theMusicAudio,a=r.currMusicDuration,c=t.clientX,o=t.target.parentNode,i=o.offsetLeft,s=o.offsetWidth,u=Math.min(1,Math.max(0,(c-i)/s));console.log("\u7f13\u51b2\u6761\u6761\u70b9\u51fb\u4e8b\u4ef6",c,i,s,u),n.currentTime=u*a,e.setState(m({},e.state,{currMusicTime:u*a})),t.stopPropagation()})),w(v(e),"clickPlayedBarHandler",(function(t){var r=e.state,n=r.theMusicAudio,a=r.currMusicDuration,c=t.clientX,o=t.target.parentNode,i=o.offsetLeft,s=o.offsetWidth,u=Math.min(1,Math.max(0,(c-i)/s));console.log("\u5df2\u64ad\u653e\u8fdb\u5ea6\u6761\u70b9\u51fb\u4e8b\u4ef6",c,i,s,u),n.currentTime=u*a,e.setState(m({},e.state,{currMusicTime:u*a}))})),w(v(e),"mouseDownControllerHandler",function(){var t=f(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("\u8fdb\u5ea6\u63a7\u5236\u5668\u6309\u4e0b\u4e8b\u4ef6",r.clientX,r.target.parentNode.offsetLeft),t.next=3,e.setState(m({},e.state,{controllerFlag:!0,controller:r.target}));case 3:document.addEventListener("mousemove",e.mouseMoveHandler),console.log(e.state.controllerFlag),e.pauseMusic();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),w(v(e),"mouseUpHandler",function(){var t=f(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.controllerFlag||!e.state.controller){t.next=6;break}return console.log("\u9f20\u6807\u677e\u5f00\u4e8b\u4ef6",r),t.next=4,e.setState(m({},e.state,{controllerFlag:!1,controller:null}));case 4:document.removeEventListener("mousemove",e.mouseMoveHandler),e.playMusic();case 6:r.stopPropagation();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),w(v(e),"mouseMoveHandler",(function(t){e.throttle((function(){if(e.state.controllerFlag){var r=e.state,n=r.theMusicAudio,a=r.controller.parentNode,c=a.offsetLeft,o=a.offsetWidth,i=r.currMusicDuration,s=t.clientX,u=Math.min(1,Math.max(0,(s-c)/o));n.currentTime=u*i,e.setState(m({},e.state,{currMusicTime:u*i}))}}),200)()})),w(v(e),"keyPressHandler",(function(t){console.log(t.keyCode);var r=e.state,n=(r.theMusicAudio,r.playFlag);switch(t.keyCode){case 32:n?e.pauseMusic():e.playMusic()}})),w(v(e),"durationChangeHandler",(function(){e.setState(m({},e.state,{currMusicDuration:e.state.theMusicAudio.duration}))})),w(v(e),"endedHandler",(function(){e.pauseMusic(),e.state.controllerFlag||e.changeMusicByNext()})),w(v(e),"timeUpdateHandler",(function(t){var r=e.state.theMusicAudio.currentTime,n=r/e.state.currMusicDuration*100;e.setState(m({},e.state,{currMusicTime:r,playedBarWidth:"".concat(n,"%"),controllerLeft:"".concat(n,"%")}))})),w(v(e),"bufferedUpdateHandler",(function(){setTimeout((function(){var t=e.state,r=t.currMusicDuration,n=t.theMusicAudio.buffered;0!=n.length&&(e.setState(m({},e.state,{currMusicBufferedLength:"".concat(n.end(n.length-1)/r*100,"%")})),n.end(n.length-1)<r&&e.bufferedUpdateHandler())}),500)})),w(v(e),"loadingResuorce",(function(){new Promise(function(){var t=f(regeneratorRuntime.mark((function t(r,n){var a,c,o,i,s,u,l,f,d,p,h,g,y,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.state,c=a.baseUrl,o=a.currMusicIndex,i=a.musicList,s="".concat(c).concat(i[o]),u={method:"GET",accept:"audio/mp3",responseType:"arraybuffer"},t.next=5,fetch(s,u);case 5:l=t.sent,f=l.body.getReader(),d=l.headers.get("Content-Length"),console.log("totalLength:",d),p=new Uint8Array(d),h=0;case 11:return t.next=14,f.read();case 14:if(g=t.sent,y=g.value,!g.done){t.next=19;break}return t.abrupt("break",27);case 19:if(!(h>d/10)){t.next=22;break}return console.log(y),t.abrupt("break",27);case 22:p.set(y,h),h+=y.length,e.setState(m({},e.state,{loadingProgress:(h/d*100).toFixed(2)+"%"})),t.next=11;break;case 27:console.log(p),v=window.URL.createObjectURL(new Blob([p])),r(v);case 30:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()).then((function(e){console.log(e)}))})),w(v(e),"sec2min",(function(e){var t=Math.floor(e/60);return e=Math.floor(e%60),"".concat(t<10?"0"+t:t,":").concat(e<10?"0"+e:e)})),w(v(e),"throttle",(function(e,t){var r=!0;return function(){if(!r)return!1;r=!1,setTimeout((function(){e(),r=!0}),t)}}));var t=new Audio(null);return e.state={theMusicAudio:t,panelFlag:!1,controllerFlag:!1,controller:null,baseUrl:"https://chengchanghu.github.io/studynote/musicplayer-react/src/components/MusicPlayer",loadingProgress:0,musicList:[{id:1,title:"\u65e5\u843d\u5927\u9053",picSrc:"/sample/img/sunset-road.jpg",musicSrc:"/sample/music/sunset-road.mp3"},{id:2,title:"\u98d8\u5411\u5317\u65b9",picSrc:"/sample/img/drift-north.jpg",musicSrc:"/sample/music/drift-north.mp3"},{id:3,title:"Skin",picSrc:"/sample/img/skin.jpg",musicSrc:"/sample/music/skin.mp3"},{id:4,title:"\u53c8\u8fc7\u4e86\u4e00\u5e74",picSrc:"/sample/img/another-year.jpg",musicSrc:"/sample/music/another-year.mp3"}],currMusicObj:null,currMusicIndex:3,currMusicDuration:0,currMusicTime:0,currMusicBufferedLength:0,playedBarWidth:0,controllerLeft:0,playFlag:!1},e.state.currMusicObj=e.state.musicList[3],e}return r=i,(n=[{key:"componentDidMount",value:function(){var e=this;console.log(this.__proto__.constructor.name,":componentDidMount");var t=this.state,r=t.theMusicAudio,n=t.currMusicObj;r.src=n.musicSrc,document.addEventListener("keypress",this.keyPressHandler),this.state.theMusicAudio.src="".concat(this.state.baseUrl).concat(this.state.musicList[this.state.currMusicIndex].musicSrc),r.addEventListener("durationchange",this.durationChangeHandler),r.addEventListener("ended",this.endedHandler),r.addEventListener("timeupdate",this.timeUpdateHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.bufferedUpdateHandler(),this.refs.localFile.addEventListener("change",(function(t){return e.changeMusicByInputFile(t)}))}},{key:"render",value:function(){var e=this,t=this.state,r=t.baseUrl,n=t.playFlag,c=t.panelFlag,o=t.musicList,i=t.currMusicObj,s=t.currMusicTime,u=t.playedBarWidth,l=t.controllerLeft,f=t.currMusicDuration,d=t.currMusicIndex,m=t.loadingProgress,p=t.currMusicBufferedLength;return a.a.createElement("div",{className:"MusicPlayer",onKeyPress:this.keyPressHandler},"loadingProgress: ",a.a.createElement("span",null,m),a.a.createElement("div",{className:"ControlBox"},a.a.createElement("div",{className:"prev"},a.a.createElement("div",{id:"prev",onClick:this.changeMusicByPrev})),a.a.createElement("div",{className:"record-cover ".concat(n?"pause-status":"play-status"),id:"recordCover"},a.a.createElement("img",{src:r+i.picSrc,alt:"\u5c01\u9762"}),a.a.createElement("div",{className:"pause",id:"pause",onClick:this.pauseMusic}),a.a.createElement("div",{className:"play",id:"play",onClick:this.playMusic})),a.a.createElement("div",{className:"next"},a.a.createElement("div",{id:"next",onClick:this.changeMusicByNext})),a.a.createElement("div",{className:"progress-box",id:"progressBox"},a.a.createElement("div",{className:"song-title"},a.a.createElement("span",{id:"songTitle"},i.title),a.a.createElement("span",{className:"more ".concat(c?"more-active":""),id:"more",onClick:this.openMusicPanel})),a.a.createElement("div",{className:"progress-bar",id:"progressBar",onClick:function(t){return e.clickProgressBarHandler(t)}},a.a.createElement("div",{className:"buffered-bar",style:{width:p},onClick:function(t){return e.clickBufferedBarHandler(t)}}),a.a.createElement("div",{className:"played-bar",onClick:function(t){console.log("played-bar"),e.clickPlayedBarHandler(t),t.stopPropagation()},style:{width:u},id:"playedBar"}),a.a.createElement("div",{className:"controller",onClick:function(e){console.log("click controller"),e.stopPropagation()},onMouseDown:function(t){e.mouseDownControllerHandler(t),t.preventDefault()},style:{left:l},id:"controller"})),a.a.createElement("div",{className:"song-duration"},a.a.createElement("span",{className:"curr-duration"},this.sec2min(s)),"/",a.a.createElement("span",{className:"total-duration"},this.sec2min(f)))),a.a.createElement("div",{className:"music-panel ".concat(c?"active-music-panel":""),id:"musicPanel"},a.a.createElement("div",{className:"panel-header"},"\u6b4c\u66f2\u9762\u677f",a.a.createElement("input",{type:"file",className:"local-file",ref:"localFile",id:"localFile"}),a.a.createElement("div",{className:"local-music",id:"localMusic",onClick:this.clickLocalMusicHandler},"\u672c\u5730\u97f3\u4e50")),a.a.createElement("ul",{className:"music-list"},o.map((function(t,n){return a.a.createElement("li",{key:t.id,className:d===n?"active-music":""},a.a.createElement("a",{href:"#",onClick:function(r){e.changeMusicByMusicPanel(t,n),r.preventDefault()}},a.a.createElement("img",{className:"pic",src:r+t.picSrc}),t.title))}))))))}}])&&h(r.prototype,n),c&&h(r,c),i}(a.a.Component);o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[133,1,2]]]);
//# sourceMappingURL=main.31cb2d44.chunk.js.map